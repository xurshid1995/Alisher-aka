{% extends "base.html" %}

{% block extra_css %}
<style>
.warehouse-grid {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 20px;
    margin: 20px 0;
}

.warehouse-card {
    width: 100%;
    height: 350px;
    background: white;
    border-radius: 8px;
    padding: 15px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    border-left: 4px solid #3498db;
    display: flex;
    flex-direction: column;
    justify-content: space-between;
}

.warehouse-card:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(0,0,0,0.15);
}

    .warehouse-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 1rem;
    }

    .warehouse-name {
        font-size: 1.4rem;
        font-weight: bold;
        color: #2c3e50;
    }

    .warehouse-status {
        padding: 0.3rem 0.8rem;
        border-radius: 20px;
        font-size: 0.8rem;
        font-weight: bold;
    }

    .status-good { background: #d5e8d4; color: #2e7d32; }
    .status-medium { background: #fff3cd; color: #856404; }
    .status-low { background: #f8d7da; color: #721c24; }

    .progress-bar {
        width: 100%;
        height: 8px;
        background: #ecf0f1;
        border-radius: 4px;
        overflow: hidden;
        margin: 0.5rem 0;
    }

    .progress-fill {
        height: 100%;
        background: linear-gradient(90deg, #27ae60, #2ecc71);
        transition: width 0.3s ease;
    }

    .progress-fill.medium { background: linear-gradient(90deg, #f39c12, #e67e22); }
    .progress-fill.low { background: linear-gradient(90deg, #e74c3c, #c0392b); }

    .warehouse-info {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 1rem;
        margin: 1rem 0;
    }

    .info-item {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        color: #7f8c8d;
        font-size: 0.9rem;
    }

    .warehouse-actions {
        display: flex;
        gap: 0.5rem;
        margin-top: 1rem;
        justify-content: space-between;
    }

    .btn-small {
        padding: 0.5rem 0.8rem;
        font-size: 0.85rem;
        border-radius: 4px;
        text-decoration: none;
        transition: all 0.3s ease;
        flex: 1;
        text-align: center;
        border: none;
        cursor: pointer;
    }

    .btn-view {
        background: #3498db;
        color: white;
    }

    .btn-view:hover {
        background: #2980b9;
        transform: translateY(-1px);
    }

    .btn-edit {
        background: #f39c12;
        color: white;
    }

    .btn-edit:hover {
        background: #e67e22;
        transform: translateY(-1px);
    }

    .btn-delete {
        background: #e74c3c;
        color: white;
    }

    .btn-delete:hover {
        background: #c0392b;
        transform: translateY(-1px);
    }

    /* RESPONSIVE DESIGN - BIR QATORDA 3 TA */
    @media (max-width: 1200px) {
        .warehouse-grid {
            grid-template-columns: repeat(2, 1fr);
        }
    }

    @media (max-width: 768px) {
        .warehouse-grid {
            grid-template-columns: 1fr;
        }
    }

    /* MUTLAQ O'ZGARMAS QOIDALAR */
    * {
        box-sizing: border-box;
    }
</style>
{% endblock %}

{% block content %}
<!-- Content Header -->
<div class="content-header" style="display: flex; justify-content: space-between; align-items: center;">
    <div>
        <h1>üè≠ Omborlar boshqaruvi</h1>
        <div class="breadcrumb">Ombor boshqaruvi / Omborlar</div>
    </div>
    <a href="/add_warehouse" class="btn btn-success" style="padding: 0.6rem 1.5rem; font-size: 0.9rem; box-shadow: 0 2px 5px rgba(0,0,0,0.1); transition: all 0.3s; font-weight: 500;">
        ‚ûï Yangi ombor qo'shish
    </a>
</div>

<!-- Warehouses Grid -->
<div class="warehouse-grid">
    {% for warehouse in warehouses %}
    <div class="warehouse-card" data-warehouse-id="{{ warehouse.id }}">
        <div class="warehouse-header">
            <div class="warehouse-name">{{ warehouse.name }}</div>
        </div>

        <div class="warehouse-info">
            <div class="info-item">
                <span>üìç</span>
                <span>{{ warehouse.address[:30] }}{% if warehouse.address|length > 30 %}...{% endif %}</span>
            </div>
            <div class="info-item">
                <span>üë§</span>
                <span>{{ warehouse.manager_name }}</span>
            </div>
            <div class="info-item">
                <span>üìû</span>
                <span>{{ warehouse.phone or 'Telefon yo\'q' }}</span>
            </div>
            <div class="info-item">
                <span>üìÖ</span>
                <span>{{ warehouse.created_date.strftime('%d.%m.%Y') if warehouse.created_date else 'Noma\'lum' }}</span>
            </div>
        </div>

        <div class="warehouse-actions">
            <a href="/warehouse/{{ warehouse.id }}" class="btn-small btn-view">
                üëÅÔ∏è Ko'rish
            </a>
            <a href="/edit_warehouse/{{ warehouse.id }}" class="btn-small btn-edit">
                ‚úèÔ∏è Tahrirlash
            </a>
            <button data-warehouse-id="{{ warehouse.id }}" 
                    data-warehouse-name="{{ warehouse.name }}"
                    onclick="deleteWarehouse(this.dataset.warehouseId, this.dataset.warehouseName)" 
                    class="btn-small btn-delete">
                üóëÔ∏è O'chirish
            </button>
        </div>
    </div>
    {% else %}
    <div class="warehouse-card" style="grid-column: 1 / -1; text-align: center;">
        <h3>Omborlar topilmadi</h3>
        <p style="color: #7f8c8d; margin: 1rem 0;">Hali omborlar qo'shilmagan. Birinchi omborni qo'shing!</p>
        <a href="/add_warehouse" class="btn btn-success">
            ‚ûï Birinchi omborni qo'shish
        </a>
    </div>
    {% endfor %}
</div>
{% endblock %}

{% block extra_js %}
<script>
    // Sidebar active link
    document.addEventListener('DOMContentLoaded', function() {
        console.log('Omborlar sahifasi yuklandi');
    });

    // Ombor o'chirish funksiyasi
    function deleteWarehouse(warehouseId, warehouseName) {
        console.log('O\'chirish funksiyasi chaqirildi:', warehouseId, warehouseName);
        
        if (confirm(`Haqiqatan ham "${warehouseName}" omborini o'chirmoqchimisiz?\n\nDiqqat: Bu amal qaytarib bo'lmaydi!`)) {
            console.log('Foydalanuvchi tasdiqladi, API ga so\'rov yuborilmoqda...');
            
            fetch(`/api/warehouse/${warehouseId}`, {
                method: 'DELETE',
                headers: {
                    'Content-Type': 'application/json',
                }
            })
            .then(response => {
                console.log('API javob olindi:', response.status, response.statusText);
                if (response.ok) {
                    console.log('Muvaffaqiyat! Sahifa qayta yuklanmoqda...');
                    window.location.reload();
                } else {
                    console.error('API xatosi:', response.status);
                    alert('Xatolik yuz berdi! Omborni o\'chirib bo\'lmadi.');
                }
            })
            .catch(error => {
                console.error('Fetch xatosi:', error);
                alert('Aloqa xatosi! Qaytadan urinib ko\'ring.');
            });
        } else {
            console.log('Foydalanuvchi bekor qildi');
        }
    }
</script>
{% endblock %}
